<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>MCCI Sliders</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: transparent;
    }

    /* ===========================
      SLIDER LATERAL (DROITE)
      =========================== */
    #container {
      position: absolute;
      right: 0;
      top: 0;
      width: 35vw;
      height: 100vh;
      overflow: hidden;
    }

    .slide {
      position: absolute;
      width: 100%;
      height: 100%;
      right: -100%;
      transition: right 1s ease-in-out;
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
    }

    .slide img {
      height: 100%;
      width: auto;
      object-fit: contain;
      object-position: right top;
    }

    .slide.active {
      right: 0;
    }

    /* ===========================
      TOP SLIDER (DESCEND DU HAUT)
      =========================== */
    #top-slider-container {
      position: absolute;
      top: 0;
      /* DÃ©caler Ã  gauche du slider droit */
      right: 35vw; /* <-- ajoute cette ligne, remplace right: 0 */

      width: 612px;
      height: 128px;

      overflow: visible;

      transform: translateY(-130%);  /* cachÃ© vers le haut */
      transition: transform 0.8s ease-in-out;
      z-index: 99999;
    }

    #top-slider-container.show {
      transform: translateY(0);       /* descend */
    }

    /* zone de superposition */
    .top-slide-wrapper {
      position: relative;
      width: 612px;     /* match exact */
      height: 128px;
    }

    /* images superposÃ©es pixel perfect */
    .top-slide-img {
      position: absolute;
      top: 0;
      right: 0;

      width: 612px;     /* â¬… aucune dÃ©formation */
      height: 128px;

      object-fit: none;       /* pas de scaling */
      object-position: right top;

      /* anti-flou pixel art */
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
  </style>
</head>

<body>

  <!-- SLIDER PRINCIPAL -->
  <div id="container"></div>

  <!-- TOP SLIDER -->
  <div id="top-slider-container">
    <div class="top-slide-wrapper">
      <img id="top-img-1" class="top-slide-img" src="">
      <img id="top-img-2" class="top-slide-img" src="">
    </div>
  </div>

  <!-- ===========================
       FIREBASE + LOGIQUE
       =========================== -->
  <script type="module">
    /* =============================================================
      ðŸ”¥ 1 â€” IMPORT FIREBASE
      ============================================================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCFIMChxjUJ62UETvb8j4tpS1eWuLl4KC4",
      authDomain: "mcci-sliders.firebaseapp.com",
      databaseURL: "https://mcci-sliders-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "mcci-sliders",
      storageBucket: "mcci-sliders.firebasestorage.app",
      messagingSenderId: "417632457228",
      appId: "1:417632457228:web:cb61fc91cbd85c0f3f9429",
      measurementId: "G-7C7N042H6S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);


    /* =============================================================
      ðŸ”„ 2 â€” SLIDER DE DROITE
      ============================================================= */
    let index = 0;
    const pauseAfterCycleMinutes = 1.5;
    const pauseAfterCycle = pauseAfterCycleMinutes * 60 * 1000;

    const slidesConfig = [
      { src: "images/1.png", duration: 10 },
      { src: "images/2.png", duration: 10 },
      { src: "images/3.png", duration: 6 },
      { src: "images/4.png", duration: 6 },
      { src: "images/5.png", duration: 6 },
      { src: "images/6.png", duration: 6 },
      { src: "images/7.png", duration: 6 },
      { src: "images/8.png", duration: 6 },
      { src: "images/9.png", duration: 6 }
    ];

    const container = document.getElementById("container");

    // CrÃ©e les slides
    slidesConfig.forEach(item => {
      const div = document.createElement("div");
      div.className = "slide";

      const imageElement = document.createElement("img");
      imageElement.src = item.src;
      div.appendChild(imageElement);

      container.appendChild(div);
    });

    const slides = document.querySelectorAll(".slide");

    // Fonction pour faire dÃ©filer les slides
    function nextSlide() {
      if (index > 0) slides[index - 1].classList.remove("active");

      if (index < slides.length) {
        slides[index].classList.add("active");

        const durationMs = slidesConfig[index].duration * 1000;
        index++;
        setTimeout(nextSlide, durationMs);
      } else {
        slides.forEach(slide => slide.classList.remove("active"));
        index = 0;
        setTimeout(nextSlide, pauseAfterCycle);
      }
    }

    nextSlide();


    /* =============================================================
      ðŸ”½ 3 â€” TOP SLIDER EN TEMPS RÃ‰EL (FIREBASE) AVEC TRIGGER
      ============================================================= */
    const topContainer = document.getElementById("top-slider-container");
    const topImg1 = document.getElementById("top-img-1");
    const topImg2 = document.getElementById("top-img-2");

    let lastTriggerValue = null; // mÃ©morise la derniÃ¨re valeur du trigger

    const topSliderRef = ref(db, "topSlider");

    onValue(topSliderRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      // Normalise les valeurs pour gÃ©rer "None" / "none"
      const gameVal = (data.game || "").toLowerCase();
      const multVal = (data.mult || "").toLowerCase();

      // VÃ©rifie si le trigger a changÃ©
      const triggerChanged = data.trigger && data.trigger !== lastTriggerValue;
      lastTriggerValue = data.trigger; // on mÃ©morise toujours le trigger

      // Si game ou mult vaut "none", on ne fait rien
      if (gameVal === "none" || multVal === "none") {
        topContainer.classList.remove("show"); // s'assure qu'il est cachÃ©
        return; // mais trigger est mÃ©morisÃ©
      }

      // Affiche le top-slider uniquement si trigger a changÃ©
      if (triggerChanged) {
        // Met Ã  jour les images
        topImg1.src = "topslides/" + data.mult + ".gif";
        topImg2.src = "topslides/" + data.game + ".png";

        // Affiche le top-slider
        topContainer.classList.add("show");

        // Cache le top-slider aprÃ¨s 5 secondes
        setTimeout(() => {
          topContainer.classList.remove("show");
        }, 5000);
      }
    });
  </script>
</body>
</html>
