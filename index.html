<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <title>MCCI Sliders</title>

  <style>
    :root {
      --scores-border: #000;
      --scores-main-color: #294683;
      --scores-main-color-light: #3B5B9D;
      --scores-main-color-shadow: #1B335E;
      --scores-second-color: #132544;
    }
    @font-face {
      font-family: 'Minecraftia';
      src: url('./font/minecraftia.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    body {
      margin: 0;
      overflow: hidden;
      background: transparent;
    }

    /* ===========================
      SLIDER LATERAL (DROITE)
      =========================== */
    #container {
      position: absolute;
      right: 0;
      top: 0;
      width: 35vw;
      height: 100vh;
      overflow: hidden;
    }

    .slide {
      position: absolute;
      width: 100%;
      height: 100%;
      right: -100%;
      transition: right 1s ease-in-out;
      display: flex;
      justify-content: flex-end;
      align-items: flex-start;
    }

    .slide img {
      height: 100%;
      width: auto;
      object-fit: contain;
      object-position: right top;
    }

    .slide.active {
      right: 0;
    }

    /* ===========================
      TOP SLIDER (DESCEND DU HAUT)
      =========================== */
    #top-slider-container {
      position: fixed; /* reste au-dessus et scroll ind√©pendant */
      top: 0;
      left: 50%;       /* centre horizontalement */
      transform: translate(-50%, -130%); /* cache au d√©part */
      width: 612px;
      height: 128px;
      overflow: visible;
      transition: transform 0.8s ease-in-out;
      z-index: 100000; /* tr√®s haut pour passer au-dessus */
    }

    #top-slider-container.show {
      transform: translate(-50%, 0); /* descend au centre */
    }

    /* zone de superposition */
    .top-slide-wrapper {
      position: relative;
      width: 612px;     /* match exact */
      height: 128px;
    }

    /* images superpos√©es pixel perfect */
    .top-slide-img {
      position: absolute;
      top: 0;
      right: 0;

      width: 612px;     /* ‚¨Ö aucune d√©formation */
      height: 128px;

      object-fit: none;       /* pas de scaling */
      object-position: right top;

      /* anti-flou pixel art */
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    #second-top-slider-container {
      position: fixed; /* passe au-dessus de tout */
      top: 0;
      left: 50%;       /* centre horizontalement */
      transform: translate(-50%, -150%); /* cach√© au d√©part */
      width: auto;
      height: auto;
      box-shadow: inset 0 -4px 0 0 var(--scores-main-color-shadow),
                  inset 4px 0 0 0 var(--scores-main-color-light),
                  inset -4px 0 0 0 var(--scores-main-color-shadow),
                  inset 0 4px 0 0 var(--scores-main-color-light);
      background: var(--scores-main-color);
      padding: 10px;
      border-radius: 0px;
      border: 4px solid var(--scores-border);
      opacity: 0;
      transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
      z-index: 100001; /* encore plus haut que top slider */
      pointer-events: none;
    }


    #second-top-slider-container.show {
      transform: translate(-50%, 0);
      opacity: 1;
      pointer-events: auto;
    }
    .second-grid {
      display: grid;
      gap: 10px;
      grid-auto-rows: 1fr;
    }
    .second-grid.two-rows {
      grid-template-rows: repeat(2, 1fr);
    }

    .second-grid.one-row {
      grid-template-rows: 1fr;
    }
    .cell {
      display: flex;
      align-items: center;
      background: var(--scores-second-color);
      box-shadow: inset 0 6px 0 0 rgba(0, 0, 0, .3);
      justify-content: flex-start;
      gap: 15px;
      padding: 5px 10px;
    }
    .cell-value {
      font-family: 'Minecraftia', sans-serif;
      line-height: 1;
      font-size: 24px;
      margin-top: 24px;
      color: white;
    }
    .cell-logo {
      width: 48px;
      height: 48px;
      object-fit: contain;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }
  </style>
</head>







<body>

  <!-- SLIDER PRINCIPAL -->
  <div id="container"></div>

  <!-- TOP SLIDER -->
  <div id="top-slider-container">
    <div class="top-slide-wrapper">
      <img id="top-img-1" class="top-slide-img" src="">
      <img id="top-img-2" class="top-slide-img" src="">
    </div>
  </div>
  <div id="second-top-slider-container">
    <div class="second-grid">
      <div class="cell">
      <img src="factions/red.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/orange.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/yellow.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/lime.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/green.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/cyan.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/aqua.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/blue.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/purple.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
      <div class="cell">
      <img src="factions/pink.png" class="cell-logo" />
      <div class="cell-value">0</div>
      </div>
    </div>
  </div>











  <script type="module">
    /* =============================================================
      üî• 1 ‚Äî IMPORT FIREBASE
      ============================================================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCFIMChxjUJ62UETvb8j4tpS1eWuLl4KC4",
      authDomain: "mcci-sliders.firebaseapp.com",
      databaseURL: "https://mcci-sliders-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "mcci-sliders",
      storageBucket: "mcci-sliders.firebasestorage.app",
      messagingSenderId: "417632457228",
      appId: "1:417632457228:web:cb61fc91cbd85c0f3f9429",
      measurementId: "G-7C7N042H6S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    /* =============================================================
      üîÑ 2 ‚Äî SLIDER DE DROITE
      ============================================================= */
    let index = 0;
    const pauseAfterCycleMinutes = 1.5;
    const pauseAfterCycle = pauseAfterCycleMinutes * 60 * 1000;

    const slidesConfig = [
      { src: "images/1.png", duration: 10 },
      { src: "images/2.png", duration: 10 },
      { src: "images/3.png", duration: 6 },
      { src: "images/4.png", duration: 6 },
      { src: "images/5.png", duration: 6 },
      { src: "images/6.png", duration: 6 },
      { src: "images/7.png", duration: 6 },
      { src: "images/8.png", duration: 6 }
    ];

    const container = document.getElementById("container");

    // Cr√©e les slides
    slidesConfig.forEach(item => {
      const div = document.createElement("div");
      div.className = "slide";

      const imageElement = document.createElement("img");
      imageElement.src = item.src;
      div.appendChild(imageElement);

      container.appendChild(div);
    });

    const slides = document.querySelectorAll(".slide");

    // Fonction pour faire d√©filer les slides
    function nextSlide() {
      if (index > 0) slides[index - 1].classList.remove("active");

      if (index < slides.length) {
        slides[index].classList.add("active");

        const durationMs = slidesConfig[index].duration * 1000;
        index++;
        setTimeout(nextSlide, durationMs);
      } else {
        slides.forEach(slide => slide.classList.remove("active"));
        index = 0;
        setTimeout(nextSlide, pauseAfterCycle);
      }
    }

    nextSlide();

    /* =============================================================
      üîΩ 3 ‚Äî TOP SLIDER EN TEMPS R√âEL (FIREBASE) AVEC TRIGGER
      ============================================================= */
    const topContainer = document.getElementById("top-slider-container");
    const topImg1 = document.getElementById("top-img-1"); // multiplier
    const topImg2 = document.getElementById("top-img-2"); // game

    let lastTopTrigger = null; // m√©morise le dernier trigger

    const topSliderRef = ref(db, "topSlider");

    onValue(topSliderRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const gameVal = (data.game || "").toLowerCase();
      const multVal = (data.mult || "").toLowerCase();

      // D√©tecte le changement de trigger
      const triggerChanged = data.trigger && data.trigger !== lastTopTrigger;
      lastTopTrigger = data.trigger;

      // Si "none", on cache le slider
      if (gameVal === "none" || multVal === "none") {
        topContainer.classList.remove("show");
        return;
      }

      // Affichage uniquement si trigger change
      if (triggerChanged) {
        topImg1.src = "topslides/" + multVal + ".gif"; // multiplier
        topImg2.src = "topslides/" + gameVal + ".png"; // game

        // Animation d'apparition
        topContainer.classList.add("show");

        // Dispara√Æt apr√®s 10 secondes
        setTimeout(() => {
          topContainer.classList.remove("show");
        }, 10000);
      }
    });

    /* =============================================================
      üîΩ 4 ‚Äî LEADERBOARD SCORES (AFFICHAGE SUR TRIGGER)
      ============================================================= */
    const scoresRef = ref(db, "scores");
    const grid = document.querySelector(".second-grid");
    const leaderboardContainer = document.getElementById("second-top-slider-container");
    const zTriggerRef = ref(db, "scores/z_trigger");

    let lastZTrigger = null;
    let lastScores = null; // stocke les scores mais n'affiche pas

    // Lecture des scores (mais pas d'affichage encore)
    onValue(scoresRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      // IGNORER z_trigger + ignorer les √©quipes en -1
      lastScores = Object.entries(data)
        .filter(([key, val]) => key !== "z_trigger" && Number(val) !== -1)
        .map(([faction, value]) => ({
          faction,
          value: Number(value) || 0
        }))
        .sort((a, b) => b.value - a.value);
    });

    // D√©clenchement uniquement sur changement du trigger
    onValue(zTriggerRef, (snapshot) => {
      const value = snapshot.val();
      if (!value) return;

      const changed = value !== lastZTrigger;
      lastZTrigger = value;

      if (!changed || !lastScores) return
      ;
      // VIDER LA GRILLE
      grid.innerHTML = "";
      const count = lastScores.length;
      let cols = Math.ceil(count / 2);
      if (count <= 5) {
        grid.style.gridTemplateColumns = `repeat(${count}, 1fr)`;
        grid.classList.add("one-row");
        grid.classList.remove("two-rows");
      } else {
        const top = cols;
        const bot = count - cols;
        grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
        grid.classList.add("two-rows");
        grid.classList.remove("one-row");
      }
      lastScores.forEach(item => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.innerHTML = `
          <img src="factions/${item.faction}.png" class="cell-logo" />
          <div class="cell-value">${item.value}</div>
        `;
        grid.appendChild(cell);
      });
      leaderboardContainer.classList.add("show");

      // Disparition
      setTimeout(() => {
        leaderboardContainer.classList.remove("show");
      }, 10000);
    });
  </script>
</body>
</html>
